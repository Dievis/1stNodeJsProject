doctype html
html
  head
    title Admin Dashboard
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css", rel="stylesheet")
    link(href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css", rel="stylesheet")
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
  body
    .d-flex
      // Sidebar
      nav.flex-column.bg-dark.text-white.p-3.sidebar
        h4.text-center.mb-4.text-white Admin Menu
        ul.nav.nav-pills.flex-column
          li.nav-item
            a.nav-link.active(href='/admin/dashboard') Dashboard
          li.nav-item
            a.nav-link(href='/admin/products') Products
          li.nav-item
            a.nav-link(href='/admin/categories') Categories
          li.nav-item
            a.nav-link(href='/admin/users') Users
          li.nav-item
            a.nav-link(href='/admin/orders') Orders
          li.nav-item
            form(action='/auth/logout', method='POST', class='d-inline')
              button.btn.btn-link.text-white.nav-link(type='submit') 
                i.fas.fa-sign-out-alt.me-2
                | Logout

      // Main Content
      .flex-grow-1.p-4
        block content

    block scripts
  script.
    document.addEventListener('DOMContentLoaded', () => {
      // Xóa sản phẩm
      document.querySelectorAll('.delete-product').forEach(button => {
        button.addEventListener('click', async (e) => {
          const row = e.target.closest('tr');
          const productId = row.getAttribute('data-id');
          if (confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) {
            try {
              const response = await fetch(`/products/${productId}`, {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
              const result = await response.json();
              if (result.success) {
                alert('Xóa sản phẩm thành công!');
                row.remove();
              } else {
                alert('Xóa sản phẩm thất bại: ' + result.message);
              }
            } catch (error) {
              console.error('Error deleting product:', error);
              alert('Đã xảy ra lỗi khi xóa sản phẩm.');
            }
          }
        });
      });

      // Sửa sản phẩm
      document.querySelectorAll('.edit-product').forEach(button => {
        button.addEventListener('click', (e) => {
          const row = e.target.closest('tr');
          const productId = row.getAttribute('data-id');
          const name = row.children[0].innerText;
          const price = row.children[1].innerText.replace('$', '');
          const quantity = row.children[2].innerText;
          const category = row.children[3].innerText;

          // Điền thông tin vào modal
          const form = document.querySelector('#editProductForm');
          form.id.value = productId;
          form.name.value = name;
          form.price.value = price;
          form.quantity.value = quantity;
          form.category.value = category;

          // Hiển thị modal
          $('#editProductModal').modal('show');
        });
      });

      // Gửi yêu cầu thêm sản phẩm
      document.querySelector('#addProductForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const body = {
          name: form.name.value,
          price: form.price.value,
          quantity: form.quantity.value,
          category: form.category.value
        };

        try {
          const response = await fetch('/products', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
          const result = await response.json();
          if (result.success) {
            alert('Thêm sản phẩm thành công!');
            location.reload(); // Tải lại trang
          } else {
            alert('Thêm sản phẩm thất bại: ' + result.message);
          }
        } catch (error) {
          console.error('Error adding product:', error);
          alert('Đã xảy ra lỗi khi thêm sản phẩm.');
        }
      });

      // Gửi yêu cầu cập nhật sản phẩm
      document.querySelector('#editProductForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const productId = form.id.value;
        const body = {
          name: form.name.value,
          price: form.price.value,
          quantity: form.quantity.value,
          category: form.category.value
        };

        try {
          const response = await fetch(`/products/${productId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
          const result = await response.json();
          if (result.success) {
            alert('Cập nhật sản phẩm thành công!');
            location.reload(); // Tải lại trang
          } else {
            alert('Cập nhật sản phẩm thất bại: ' + result.message);
          }
        } catch (error) {
          console.error('Error updating product:', error);
          alert('Đã xảy ra lỗi khi cập nhật sản phẩm.');
        }
      });
    });

        